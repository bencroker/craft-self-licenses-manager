{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * plugin-license-manager plugin for Craft CMS 3.x
 *
 * plugin-license-manager index.twig
 *
 * @author    Kffein
 * @copyright Copyright (c) 2018 Kffein
 * @link      kffein.com
 * @package   Pluginlicensemanager
 * @since     1.0.0
 */
#}


{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("kffein\\pluginlicensemanager\\assetbundles\\pluginlicensemanager\\PluginlicensemanagerAsset") %}

{% set docsUrl = "???" %}

{% set title = "Plugin license manager" %}

{% set pluginCpUrl = url('plugin-license-manager') %}


{% set extraPageHeaderHtml %}
    <div class="buttons">
        <a href="{{ pluginCpUrl }}" class="btn submit add icon">{{ "Click Me!"|t('plugin-license-manager') }}</a>
    </div>
{% endset %}

{% set content %}

    <div class="pluginlicensemanager-plugin">


        {% set pluginErrors = craft.pluginlicensemanager.errors %}
        {% set unregisteredPlugins = craft.pluginlicensemanager.unregisteredPlugins %}
        {% set settings = craft.pluginlicensemanager.settings %}
        {% set requestPostPluginsHandle = craft.request.getPost('pluginsHandle') ?? [] %}

        {% if pluginErrors %}
            {% switch pluginErrors %}
                {% case "Invalid Credentials" %}
                {{'index__errors__invalidCredential'|t('plugin-license-manager'|raw)}}
            {% endswitch %}
        

        {% else %}

            <h2 class="subtitle">{{'index__title'|t('plugin-license-manager')}}</h2>


            {% if unregisteredPlugins|length %}

                <form method="post" data-saveshortcut data-confirm-unload action="{{ actionUrl('plugin-license-manager/default/generate') }}">
                    {{ csrfInput() }}
                    {{ redirectInput('plugin-license-manager') }}

                    {% for plugin in unregisteredPlugins %}
                        {% set formName = 'pluginsHandle[' ~ plugin.handle ~']' %}
                        {% set isSwitchOn = requestPostPluginsHandle is not empty and requestPostPluginsHandle[plugin.handle] and requestPostPluginsHandle[plugin.handle] == '1' %}
                        
                        
                        <div class="plugin-info">
                            
                            <div class="plugin-info-icon">
                                <img src="{{plugin.iconUrl}}" class="plugin-icon" />
                            </div>

                            <div class="plugin-info-content">
                                <p><strong>{{plugin.name}}</strong></p>
                                <p>{{plugin.handle}}</p>
                                <p>{{plugin.version}}</p>
                            </div>

                            <div class="plugin-info-lightswitch">
                                {{ forms.lightswitchField({
                                    id: plugin.handle,
                                    name: formName,
                                    on: isSwitchOn,
                                }) }}
                            </div>

                            
                        </div>

                    {% endfor %}

                    <input type="submit" class="btn submit" value="{{'index__form__button__label'|t('plugin-license-manager')}}">
                    

                </form>

            {% else %}

                <p>{{'index__allpluginactivated'|t('plugin-license-manager')}}</p>

            {% endif %}


        {% endif %}

    </div>

    


{% endset %}
